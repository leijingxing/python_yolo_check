# 情绪监控系统设计文档

## 1. 系统概述
本系统旨在通过摄像头实时捕捉用户面部表情，识别情绪状态，并将数据持久化存储以便后续分析。系统设计强调低频高效的数据采集与结构化的数据存储。

## 2. 核心模块

### 2.1 数据采集模块 (`main.py`)
- **功能**：
  - 调用摄像头获取实时视频流。
  - 加载 YOLOv8 表情检测模型进行推理。
  - 实现**降频采样**机制，控制数据记录频率（例如：1秒/次）。
  - 实时显示带有表情标注的视频画面。
- **输入**：摄像头视频流。
- **输出**：实时画面展示、写入数据库的情绪记录。

### 2.2 数据存储模块 (SQLite)
- **数据库文件**：`emotion_monitor.db`
- **表结构**：`emotion_records`
  - `id`: INTEGER PRIMARY KEY AUTOINCREMENT
  - `timestamp`: DATETIME (格式：YYYY-MM-DD HH:MM:SS)
  - `emotion`: TEXT (英文表情标签，如 'happy')
  - `confidence`: REAL (置信度，保留2位小数)
- **选择理由**：Python 原生支持，单文件易于管理，支持 SQL 聚合查询，性能足以应对秒级数据量。

### 2.3 数据分析模块 (`analyze_emotion.py`) - *待开发*
- **功能**：
  - 连接数据库，读取历史记录。
  - 提供基础统计功能（如：各类情绪占比、今日主要情绪）。
  - (可选) 生成可视化图表。

## 3. 开发计划

### 阶段一：采集与存储 (当前任务)
1.  **修改 `main.py`**：
    - 引入 `sqlite3` 和 `time` 库。
    - 初始化数据库连接和建表操作。
    - 在主循环中加入时间戳判断逻辑，仅在 `当前时间 - 上次记录时间 >= 1秒` 时触发数据库写入。
    - 优化控制台输出，减少刷屏。

### 阶段二：数据分析 (后续任务)
1.  **创建 `analyze_emotion.py`**：
    - 编写 SQL 查询语句统计各类情绪数量。
    - 计算并展示百分比。

## 4. 注意事项
- 确保数据库连接在程序退出（如按 'q' 键）时正确关闭。
- 如果画面中有多个人脸，目前的策略是记录**置信度最高**的那一个，或者记录所有人脸（需讨论，目前按记录检测到的第一个人脸处理）。
